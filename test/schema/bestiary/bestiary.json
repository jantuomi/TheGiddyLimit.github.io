{
	"$schema": "http://json-schema.org/draft-07/schema#",
	"version": "1.11.0",
	"title": "Bestiary Schema",
	"$id": "bestiary.json",
	"type": "object",
	"definitions": {
		"speedVal": {
			"oneOf": [
				{
					"type": "object",
					"properties": {
						"number": {
							"type": "integer"
						},
						"condition": {
							"type": "string"
						}
					},
					"required": ["number", "condition"],
					"additionalProperties": false
				},
				{
					"type": "integer"
				}
			]
		},
		"damResist": {
			"oneOf": [
				{
					"$ref": "entry.json#/definitions/dataDmgType"
				},
				{
					"type": "object",
					"properties": {
						"special": {
							"type": "string"
						}
					},
					"additionalProperties": false,
					"required": ["special"]
				},
				{
					"type": "object",
					"properties": {
						"preNote": {
							"type": "string"
						},
						"resist": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/damResist"
							}
						},
						"note": {
							"type": "string"
						}
					},
					"additionalProperties": false,
					"required": ["resist"]
				}
			]
		},
		"damVuln": {
			"oneOf": [
				{
					"$ref": "entry.json#/definitions/dataDmgType"
				},
				{
					"type": "object",
					"properties": {
						"special": {
							"type": "string"
						}
					},
					"additionalProperties": false,
					"required": ["special"]
				},
				{
					"type": "object",
					"properties": {
						"preNote": {
							"type": "string"
						},
						"vulnerable": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/damVuln"
							}
						},
						"note": {
							"type": "string"
						}
					},
					"additionalProperties": false,
					"required": ["vulnerable"]
				}
			]
		},
		"align": {
			"oneOf": [
				{
					"type": "string",
					"enum": [
						"L",
						"N",
						"NX",
						"NY",
						"C",
						"G",
						"E",
						"U",
						"A"
					]
				},
				{
					"type": "object",
					"properties": {
						"alignment": {
							"type": "array",
							"items": {
								"$ref": "#/definitions/align"
							}
						},
						"chance": {
							"type": "integer"
						}
					},
					"additionalProperties": false,
					"required": ["alignment"]
				},
				{
					"type": "object",
					"properties": {
						"special": {
							"type": "string"
						}
					},
					"additionalProperties": false,
					"required": ["special"]
				}
			]
		},
		"acItem": {
			"oneOf": [
				{
					"type": "object",
					"properties": {
						"ac": {
							"type": "integer"
						},
						"from": {
							"type": "array",
							"items": {
								"type": "string"
							}
						},
						"condition": {
							"type": "string"
						},
						"braces": {
							"type": "boolean"
						}
					},
					"required": ["ac"]
				},
				{
					"type": "integer"
				}
			]
		},

		"creatureData":  {
			"type": "object",
			"properties": {
				"name": {
					"type": "string"
				},
				"shortName": {
					"description": "Used anywhere a shortened form of the creatures name is required (e.g. in legendary action headers). If not supplied, a shortened name will be automatically generated from the creature's full name.",
					"type": "string"
				},
				"alias": {
					"type": "array",
					"items": {
						"type": "string"
					}
				},
				"group": {
					"description": "A group name, indexed by search. E.g. searching \"Lycanthrope\" would otherwise fail to find anything",
					"type": "string"
				},
				"level": {
					"description": "Used in sidekicks, which can have levels (and generally do not have alignment)",
					"type": "integer"
				},
				"size": {
					"type": "string",
					"enum": [
						"F",
						"D",
						"T",
						"S",
						"M",
						"L",
						"H",
						"G",
						"C",
						"V"
					]
				},
				"type": {
					"oneOf": [
						{
							"type": "object",
							"properties": {
								"type": {
									"type": "string",
									"enum": [
										"aberration",
										"beast",
										"celestial",
										"construct",
										"dragon",
										"elemental",
										"fey",
										"fiend",
										"giant",
										"humanoid",
										"monstrosity",
										"ooze",
										"plant",
										"undead"
									]
								},
								"swarmSize": {
									"type": "string",
									"enum": [
										"F",
										"D",
										"T",
										"S",
										"M",
										"L",
										"H",
										"G",
										"C",
										"V"
									]
								},
								"tags": {
									"type": "array",
									"uniqueItems": true,
									"items": {
										"oneOf": [
											{
												"type": "string"
											},
											{
												"type": "object",
												"properties": {
													"tag": {
														"type": "string"
													},
													"prefix": {
														"type": "string"
													}
												},
												"required": [
													"tag",
													"prefix"
												],
												"additionalProperties": false
											}
										]
									}
								}
							},
							"required": [
								"type"
							],
							"additionalProperties": false
						},
						{
							"type": "string",
							"enum": [
								"aberration",
								"beast",
								"celestial",
								"construct",
								"dragon",
								"elemental",
								"fey",
								"fiend",
								"giant",
								"humanoid",
								"monstrosity",
								"ooze",
								"plant",
								"undead"
							]
						}
					]
				},
				"source": {
					"type": "string"
				},
				"otherSources": {
					"type": "array",
					"items": {
						"oneOf": [
							{
								"type": "object",
								"properties": {
									"source": {
										"type": "string"
									},
									"page": {
										"type": "integer"
									}
								},
								"required": [
									"source"
								],
								"additionalProperties": false
							}
						]
					}
				},
				"externalSources": {
					"description": "For homebrew use only.",
					"type": "array",
					"items": {
						"type": "object",
						"properties": {
							"entry": {
								"$ref": "entry.json"
							}
						},
						"required": [
							"entry"
						],
						"additionalProperties": false
					}
				},
				"alignment": {
					"type": "array",
					"items": {
						"$ref": "#/definitions/align"
					}
				},
				"ac": {
					"type": "array",
					"items": {
						"$ref": "#/definitions/acItem"
					}
				},
				"hp": {
					"oneOf": [
						{
							"type": "object",
							"properties": {
								"average": {
									"type": "integer"
								},
								"formula": {
									"type": "string"
								}
							},
							"additionalProperties": false
						},
						{
							"type": "object",
							"properties": {
								"special": {
									"type": "string"
								}
							},
							"additionalProperties": false
						}
					]
				},
				"speed": {
					"type": "object",
					"properties": {
						"walk": {
							"$ref": "#/definitions/speedVal"
						},
						"burrow": {
							"$ref": "#/definitions/speedVal"
						},
						"climb": {
							"$ref": "#/definitions/speedVal"
						},
						"fly": {
							"$ref": "#/definitions/speedVal"
						},
						"canHover": {
							"type": "boolean"
						},
						"swim": {
							"$ref": "#/definitions/speedVal"
						},
						"choose": {
							"type": "object",
							"properties": {
								"from": {
									"type": "array",
									"items": {
										"type": "string",
										"enum": [
											"walk",
											"burrow",
											"climb",
											"fly",
											"swim"
										]
									}
								},
								"amount": {
									"type": "integer"
								},
								"note": {
									"type": "string"
								}
							},
							"required": ["amount", "from"],
							"additionalProperties": false
						},
						"alternate": {
							"type": "object",
							"properties": {
								"walk": {
									"type": "array",
									"items": {
										"$ref": "#/definitions/speedVal"
									}
								},
								"burrow": {
									"type": "array",
									"items": {
										"$ref": "#/definitions/speedVal"
									}
								},
								"climb": {
									"type": "array",
									"items": {
										"$ref": "#/definitions/speedVal"
									}
								},
								"fly": {
									"type": "array",
									"items": {
										"$ref": "#/definitions/speedVal"
									}
								},
								"swim": {
									"type": "array",
									"items": {
										"$ref": "#/definitions/speedVal"
									}
								}
							}
						}
					},
					"additionalProperties": false
				},
				"str": {
					"type": "integer"
				},
				"dex": {
					"type": "integer"
				},
				"con": {
					"type": "integer"
				},
				"int": {
					"type": "integer"
				},
				"wis": {
					"type": "integer"
				},
				"cha": {
					"type": "integer"
				},
				"save": {
					"type": "object",
					"properties": {
						"str": {"type": "string"},
						"dex": {"type": "string"},
						"con": {"type": "string"},
						"int": {"type": "string"},
						"wis": {"type": "string"},
						"cha": {"type": "string"},
						"special": {
							"description": "For use in homebrew.",
							"$ref": "entry.json"
						}
					},
					"additionalProperties": false
				},
				"skill": {
					"type": "object",
					"properties": {
						"acrobatics": {
							"type": "string"
						},
						"animal handling": {
							"type": "string"
						},
						"arcana": {
							"type": "string"
						},
						"athletics": {
							"type": "string"
						},
						"deception": {
							"type": "string"
						},
						"history": {
							"type": "string"
						},
						"insight": {
							"type": "string"
						},
						"intimidation": {
							"type": "string"
						},
						"investigation": {
							"type": "string"
						},
						"medicine": {
							"type": "string"
						},
						"nature": {
							"type": "string"
						},
						"perception": {
							"type": "string"
						},
						"performance": {
							"type": "string"
						},
						"persuasion": {
							"type": "string"
						},
						"religion": {
							"type": "string"
						},
						"sleight of hand": {
							"type": "string"
						},
						"stealth": {
							"type": "string"
						},
						"survival": {
							"type": "string"
						},
						"other": {
							"type": "array",
							"items": {
								"type": "object",
								"properties": {
									"oneOf": {
										"type": "object",
										"acrobatics": {
											"type": "string"
										},
										"animal handling": {
											"type": "string"
										},
										"arcana": {
											"type": "string"
										},
										"athletics": {
											"type": "string"
										},
										"deception": {
											"type": "string"
										},
										"history": {
											"type": "string"
										},
										"insight": {
											"type": "string"
										},
										"intimidation": {
											"type": "string"
										},
										"investigation": {
											"type": "string"
										},
										"medicine": {
											"type": "string"
										},
										"nature": {
											"type": "string"
										},
										"perception": {
											"type": "string"
										},
										"performance": {
											"type": "string"
										},
										"persuasion": {
											"type": "string"
										},
										"religion": {
											"type": "string"
										},
										"sleight of hand": {
											"type": "string"
										},
										"stealth": {
											"type": "string"
										},
										"survival": {
											"type": "string"
										}
									}
								}
							}
						},
						"special": {
							"description": "For use in homebrew.",
							"$ref": "entry.json"
						}
					},
					"additionalProperties": false
				},
				"senses": {
					"oneOf": [
						{
							"type": "array",
							"items": {
								"type": "string"
							}
						},
						{
							"type": "null"
						}
					]
				},
				"passive": {
					"type": "integer"
				},
				"languages": {
					"oneOf": [
						{
							"type": "array",
							"items": {
								"type": "string"
							}
						},
						{
							"type": "null"
						}
					]
				},
				"cr": {
					"oneOf": [
						{
							"type": "string"
						},
						{
							"type": "object",
							"properties": {
								"cr": {
									"type": "string"
								},
								"lair": {
									"type": "string"
								},
								"coven": {
									"type": "string"
								}
							},
							"additionalProperties": false,
							"required": ["cr"]
						}
					]
				},
				"vulnerable": {
					"type": "array",
					"items": {
						"$ref": "#/definitions/damVuln"
					}
				},
				"resist": {
					"type": "array",
					"items": {
						"$ref": "#/definitions/damResist"
					}
				},
				"conditionImmune": {
					"type": "array",
					"items": {
						"$ref": "entry.json#/definitions/dataCondImmune"
					}
				},
				"immune": {
					"oneOf": [
						{
							"type": "array",
							"items": {
								"$ref": "entry.json#/definitions/dataDamImmune"
							}
						},
						{
							"type": "null"
						}
					]
				},
				"spellcasting": {
					"oneOf": [
						{
							"type": "array",
							"items": {
								"$ref": "entry.json#/definitions/entrySpellcasting"
							}
						},
						{
							"type": "null"
						}
					]
				},
				"trait": {
					"oneOf": [
						{
							"type": "array",
							"items": {
								"type": "object",
								"properties": {
									"name": {
										"type": "string"
									},
									"entries": {
										"type": "array",
										"items": {
											"$ref": "entry.json"
										}
									},
									"type": {
										"type": "string",
										"enum": ["entries", "inset"]
									}
								},
								"required": [
									"name",
									"entries"
								],
								"additionalProperties": false
							}
						},
						{
							"type": "null"
						}
					]
				},
				"action": {
					"oneOf": [
						{
							"type": "array",
							"items": {
								"type": "object",
								"properties": {
									"name": {
										"type": "string"
									},
									"entries": {
										"type": "array",
										"items": {
											"$ref": "entry.json"
										}
									}
								},
								"required": [
									"name",
									"entries"
								],
								"additionalProperties": false
							}
						},
						{
							"type": "null"
						}
					]
				},
				"reaction": {
					"type": "array",
					"items": {
						"type": "object",
						"properties": {
							"name": {
								"type": "string"
							},
							"entries": {
								"type": "array",
								"items": {
									"$ref": "entry.json"
								}
							}
						},
						"required": [
							"name",
							"entries"
						],
						"additionalProperties": false
					}
				},
				"legendaryGroup": {
					"type": "object",
					"properties": {
						"name": {
							"type": "string"
						},
						"source": {
							"type": "string"
						}
					}
				},
				"legendaryActions": {
					"type": "number"
				},
				"legendaryHeader": {
					"type": "array",
					"items": {
						"$ref": "entry.json"
					}
				},
				"legendary": {
					"type": "array",
					"items": {
						"type": "object",
						"properties": {
							"name": {
								"type": "string"
							},
							"entries": {
								"type": "array",
								"items": {
									"$ref": "entry.json"
								}
							}
						},
						"required": [
							"entries"
						],
						"additionalProperties": false
					}
				},
				"variant": {
					"type": "array",
					"items": {
						"type": "object",
						"properties": {
							"type": {
								"type": "string"
							},
							"name": {
								"type": "string"
							},
							"entries": {
								"type": "array",
								"items": {
									"$ref": "entry.json"
								}
							},
							"token": {
								"type": "object",
								"properties": {
									"name": {
										"type": "string"
									},
									"source": {
										"type": "string"
									},
									"page": {
										"type": "integer"
									}
								},
								"required": ["name", "source"]
							},
							"variantSource": {
								"type": "object",
								"properties": {
									"source": {
										"type": "string"
									},
									"page": {
										"type": "integer"
									}
								}
							}
						},
						"additionalProperties": false
					}
				},
				"page": {
					"type": "integer"
				},
				"familiar": {
					"type": "boolean"
				},
				"additionalSources": {
					"type": "array",
					"items": {
						"type": "object",
						"properties": {
							"source": {
								"type": "string"
							},
							"page": {
								"type": "integer"
							}
						},
						"required": [
							"source",
							"page"
						],
						"additionalProperties": false
					}
				},
				"tokenUrl": {
					"type": "string"
				},
				"altArt": {
					"type": "array",
					"items": {
						"type": "object",
						"properties": {
							"name": {
								"type": "string"
							},
							"source": {
								"type": "string"
							},
							"page": {
								"type": "integer"
							}
						},
						"required": ["name", "source"]
					}
				},
				"fluff": {
					"description": "This is intended to be used for Homebrew only - site data should include a fluff file per source",
					"oneOf": [
						{
							"type": "object",
							"properties": {
								"entries": {
									"type": "array",
									"items": {
										"$ref": "entry.json"
									}
								},
								"images": {
									"type": "array",
									"items": {
										"$ref": "entry.json#/definitions/entryImage"
									}
								}
							}
						},
						{
							"description": "A reference to a \"monsterFluff\" array item",
							"type": "object",
							"properties": {
								"_monsterFluff": {
									"type": "object",
									"properties": {
										"name": {
											"type": "string"
										},
										"source": {
											"type": "string"
										}
									}
								}
							}
						}
					]
				},
				"isNamedCreature": {
					"type": "boolean"
				},
				"isNpc": {
					"description": "Used to flag quest-specific NPCs",
					"type": "boolean"
				},
				"environment": {
					"type": "array",
					"items": {
						"type": "string",
						"enum": [
							"underwater",
							"coastal",
							"mountain",
							"grassland",
							"hill",
							"arctic",
							"urban",
							"forest",
							"swamp",
							"underdark",
							"desert"
						]
					}
				},
				"soundClip": {
					"type": "string"
				},
				"dragonCastingColor": {
					"type": "string",
					"enum": [
						"B", "U", "G", "R", "W", "A", "Z", "C", "O", "S"
					]
				},
				"traitTags": {
					"type": "array",
					"items": {
						"type": "string",
						"enum": [
							"Aggressive",
							"Ambusher",
							"Amorphous",
							"Amphibious",
							"Antimagic Susceptibility",
							"Brute",
							"Charge",
							"Damage Absorption",
							"Death Burst",
							"Devil's Sight",
							"False Appearance",
							"Fey Ancestry",
							"Flyby",
							"Hold Breath",
							"Illumination",
							"Immutable Form",
							"Incorporeal Movement",
							"Keen Senses",
							"Legendary Resistances",
							"Light Sensitivity",
							"Magic Resistance",
							"Magic Weapons",
							"Pack Tactics",
							"Pounce",
							"Rampage",
							"Reckless",
							"Regeneration",
							"Rejuvenation",
							"Shapechanger",
							"Siege Monster",
							"Sneak Attack",
							"Spider Climb",
							"Sunlight Sensitivity",
							"Turn Immunity",
							"Turn Resistance",
							"Undead Fortitude",
							"Water Breathing",
							"Web Sense",
							"Web Walker"
						]
					}
				},
				"actionTags": {
					"type": "array",
					"items": {
						"type": "string",
						"enum": [
							"Frightful Presence",
							"Multiattack",
							"Parry",
							"Swallow",
							"Teleport",
							"Tentacles"
						]
					}
				},
				"languageTags": {
					"type": "array",
					"items": {
						"type": "string",
						"enum": [
							"AB", "AQ", "AU", "C", "CE", "CS","D", "DR", "DS", "DU", "E", "G", "GI", "GO", "GTH", "H", "I", "IG", "O", "OTH", "P", "S", "T", "TC", "TP", "U", "X", "XX"
						]
					}
				},
				"senseTags": {
					"type": "array",
					"items": {
						"type": "string",
						"enum": ["B", "D", "SD", "T", "U"]
					}
				},
				"spellcastingTags": {
					"type": "array",
					"items": {
						"type": "string",
						"enum": ["P", "I", "F", "S", "CB", "CC", "CD", "CP", "CR", "CS", "CL", "CW"]
					}
				},
				"damageTags": {
					"type": "array",
					"items": {
						"type": "string",
						"enum": ["A", "B", "C", "F", "O", "L", "N", "P", "I", "Y", "R", "S", "T"]
					}
				},
				"miscTags": {
					"type": "array",
					"items": {
						"type": "string",
						"enum": ["MW", "RW", "RCH", "THW", "RNG", "AOE"]
					}
				},
				"footer": {
					"description": "Intended for homebrew use only.",
					"type": "array",
					"items": {
						"$ref": "entry.json"
					}
				}
			},
			"additionalProperties": false
		},

		"copyModifier": {
			"anyOf": [
				{
					"type": "object",
					"properties": {
						"mode": {"const": "replaceTxt"},
						"replace": {"type":  "string"},
						"with": {"type":  "string"},
						"flags":  {"type":  "string"}
					},
					"required": ["replace", "with"],
					"additionalProperties": false
				},
				{
					"type": "object",
					"properties": {
						"mode": {"const": "appendStr"},
						"str": {"type":  "string"},
						"joiner": {"type":  "string"}
					},
					"required": ["str"],
					"additionalProperties": false
				},
				{
					"type": "object",
					"properties": {
						"mode": {"const": "prependArr"},
						"items": {
							"anyOf": [
								{"type":  "object"},
								{"type":  "array"}
							]
						}
					},
					"required": ["items"],
					"additionalProperties": false
				},
				{
					"type": "object",
					"properties": {
						"mode": {"const": "appendArr"},
						"items": {
							"anyOf": [
								{"type":  "object"},
								{"type":  "array"}
							]
						}
					},
					"required": ["items"],
					"additionalProperties": false
				},
				{
					"type": "object",
					"properties": {
						"mode": {"const": "replaceArr"},
						"replace": {"type":  "string"},
						"items": {
							"anyOf": [
								{"type":  "object"},
								{"type":  "array"}
							]
						}
					},
					"required": ["replace", "items"],
					"additionalProperties": false
				},
				{
					"type": "object",
					"properties": {
						"mode": {"const": "removeArr"},
						"names": {
							"anyOf": [
								{"type":  "string"},
								{"type":  "array"}
							]
						},
						"items": {
							"anyOf": [
								{"type":  "string"},
								{"type":  "array"}
							]
						}
					},
					"additionalProperties": false
				},
				{
					"type": "object",
					"properties": {
						"mode": {"const": "calculateProp"},
						"prop": {"type": "string"},
						"formula": {"type": "string"}
					},
					"required": ["prop", "formula"],
					"additionalProperties": false
				},
				{
					"type": "object",
					"properties": {
						"mode": {"const": "replaceSpells"},
						"spells": {"type": "object"}
					},
					"required": ["mode", "spells"],
					"additionalProperties": false
				},
				{
					"type": "object",
					"properties": {
						"mode": {"const": "addSpells"},
						"spells": {"type": "object"}
					},
					"required": ["mode", "spells"],
					"additionalProperties": false
				}
			]
		},

		"creature": {
			"anyOf": [
				{
					"type": "object",
					"$$merge": [
						{
							"$ref": "#/definitions/creatureData"
						},
						{
							"required": [
								"name",
								"size",
								"type",
								"source",
								"ac",
								"hp",
								"speed",
								"str",
								"dex",
								"con",
								"int",
								"wis",
								"cha",
								"passive",
								"cr"
							]
						}
					]
				},
				{
					"type": "object",
					"$comment": "This is a custom pre-processor tag, which merges together the array of objects into one. This allows proper inheritance, which JSON schema don't really do.",
					"$$merge": [
						{
							"$ref": "#/definitions/creatureData"
						},
						{
							"properties": {
								"_copy": {
									"type": "object",
									"properties": {
										"name": {"type": "string"},
										"source": {"type": "string"},
										"_mod": {
											"type": "object",
											"patternProperties": {
												".*": {
													"anyOf": [
														{
															"type": "string"
														},
														{
															"$ref": "#/definitions/copyModifier"
														},
														{
															"type": "array",
															"items": {
																"$ref": "#/definitions/copyModifier"
															}
														}
													]
												}
											}
										},
										"_trait": {
											"type": "object",
											"properties": {
												"name": {"type": "string"},
												"source": {"type": "string"}
											},
											"required": ["name", "source"]
										}
									},
									"required": ["name", "source"]
								}
							},
							"required": [
								"_copy"
							]
						}
					]
				}
			]
		}
	},
	"properties": {
		"monster": {
			"type": "array",
			"uniqueItems": true,
			"items": {
				"$ref": "#/definitions/creature"
			}
		},
		"_meta": {
			"type": "object",
			"properties": {
				"dependencies": {
					"type": "object",
					"properties": {
						"monster": {
							"type": "array",
							"items": {"type": "string"}
						}
					}
				},
				"otherSources": {
					"type": "object",
					"properties": {
						"monster": {
							"description": "Keys are other sources to be loaded; values are `otherSources` sources from that source to search for.",
							"type": "object"
						}
					}
				}
			}
		}
	},
	"additionalProperties": false
}
